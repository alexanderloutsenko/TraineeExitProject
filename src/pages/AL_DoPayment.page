<apex:page controller="AL_DoPaymentController" showHeader="false" sidebar="false" id="thePage">
    <h1 style="title"> 
        Do Payment for Last Month 
    </h1>
	<h2>
        {!activePublicUser.pubUserName}
    </h2>    
     <!-- show this form when payment record for last month has been already created -->
         <apex:pageBlock rendered="{!NOT(ISNULL(payRec))}">
             <apex:pageblockSection title="Actual Meter Readings"  id="detailSection" columns="1" >
              <apex:pageBlockSectionItem >
                  Payment Month: <apex:outputText value="{0,date,MMMM}">
                  		<apex:param value="{!dynamicMonth}"  />
                  </apex:outputText> 
              </apex:pageBlockSectionItem>              
              <apex:pageBlockSectionItem >
                  Electricity Meter Readings (kWt): <apex:outputField value="{!payRec.Electricity_Meter_Readings__c}" />
              </apex:pageBlockSectionItem>
              <apex:pageBlockSectionItem >
                  Gas Meter Readings (m3): <apex:outputField value="{!payRec.Gas_Meter_Readings__c}"/>
              </apex:pageBlockSectionItem>
              <apex:pageBlockSectionItem >
                  Water Meter Readings (m3): <apex:outputField value="{!payRec.Water_Meter_Readings__c}"/>
              </apex:pageBlockSectionItem>
            </apex:pageblockSection>
         </apex:pageBlock>                
     <!-- end of Show_Meter_Readings pane -->    
     <apex:form id="Form3"> 
         <apex:outputPanel id="PaymentPanel"> 
        <apex:pageBlock id="PaymentBlock" rendered="{!NOT(ISNULL(payRec))}">
             <apex:pageblockSection title="Payment Details"  id="PaymentSection" columns="1">          
              <apex:pageBlockSectionItem >
                  Payment Fullness: 
                  <apex:selectList id="Payment_Fullness" value="{!selectedPaymentType}" size="1" disabled="{!fullyPaid}">
                    <apex:selectOptions value="{!options}"/>
                        <apex:actionSupport event="onchange"  reRender="CustomSumField"/>
                  </apex:selectList>
              </apex:pageBlockSectionItem>
              <apex:pageBlockSectionItem >
                  Recommended Payment Sum: <apex:outputField value="{!payRec.Recommended_Payment_Sum__c}"/>
              </apex:pageBlockSectionItem>
              <apex:pageBlockSectionItem >
                  Remaining Sum for Payment: <apex:outputField value="{!payRec.Remaining_Sum_for_Payment__c}"/>
              </apex:pageBlockSectionItem>
              <apex:pageBlockSectionItem >
                  Sum Already Payed: <apex:outputField value="{!payRec.Sum_Already_Payed__c}"/>
              </apex:pageBlockSectionItem>
              <apex:pageBlockSectionItem >
                    Enter your sum for partial payment: <apex:inputText value="{!customSum}" disabled="{!fullyPaid}" id="CustomSumField" rendered="{!fullyPaid == false || selectedPaymentType == 'Partially'}"/> 
              </apex:pageBlockSectionItem>
              <!--apex:outputText value="If you want to pay full sum just click Do Payment button"></apex:outputText-->
                <br/>
                 <apex:commandButton id="submitPayment" action="{!doPayment}" value="Do Payment" reRender="PaymentPanel"  disabled="{!fullyPaid}"> <!-- oncomplete="refreshPaymentSection();" -->
                <!--apex:actionFunction name="refreshPaymentSection" reRender="Form3"/-->
                </apex:commandButton>
                <apex:outputLink value="{!$Page.AL_UserHomePage+'?id='+$CurrentPage.parameters.id}" styleClass="btn" style="text-decoration:none;padding:4px;" >User Home Page</apex:outputLink>
             </apex:pageblockSection>
        </apex:pageBlock>
        </apex:outputPanel>
        <apex:pageMessages />
		</apex:form>
</apex:page>